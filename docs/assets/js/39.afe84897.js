(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{375:function(s,t,a){"use strict";a.r(t);var n=a(12),r=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1-游标是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-游标是什么"}},[s._v("#")]),s._v(" 1.游标是什么")]),s._v(" "),t("p",[s._v("游标（Cursor）是一种用于处理查询结果集的数据库对象，它允许开发者按照特定的顺序逐行遍历查询结果集中的数据。游标通常用于在数据库中执行复杂的操作，例如遍历结果集、逐行处理数据、执行更新或删除操作等。")]),s._v(" "),t("p",[s._v("游标的基本思想是将查询结果集封装成一个数据结构，使得开发者可以在程序中按照自己的需求处理这些数据。游标可以类比为一个指向结果集中某一行的指针，您可以在结果集中移动这个指针，从而处理每一行数据。")]),s._v(" "),t("p",[s._v("使用 SQL 游标一般遵循如下步骤。")]),s._v(" "),t("ol",[t("li",[s._v("声明游标。首先，您需要声明一个游标，将查询结果集与游标关联起来。")]),s._v(" "),t("li",[s._v("打开游标。在使用游标之前，需要打开游标，使其准备好用于遍历数据。")]),s._v(" "),t("li",[s._v("遍历数据。您可以使用游标逐行获取数据，并在每一行上执行操作。")]),s._v(" "),t("li",[s._v("关闭游标。当您完成了对结果集的操作后，应该关闭游标以释放资源。")])]),s._v(" "),t("h2",{attrs:{id:"_2-mysql-游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-mysql-游标"}},[s._v("#")]),s._v(" 2.MySQL 游标")]),s._v(" "),t("p",[s._v("MySQL 支持存储程序（如存储过程、函数和触发器）中使用游标。语法与嵌入式SQL中的语法相同。")]),s._v(" "),t("p",[s._v("MySQL 游标具有以下属性：")]),s._v(" "),t("ul",[t("li",[s._v("敏感不定（Asensitive）")])]),s._v(" "),t("p",[s._v("服务器可能会也可能不会复制其结果集。如果复制的话，为不敏感游标，游标使用实际数据的副本。如果不复制的话，为敏感游标，游标指向实际数据，其他连接所做的任何更改都将影响游标正在使用的数据。")]),s._v(" "),t("ul",[t("li",[s._v("只读（Read only）")])]),s._v(" "),t("p",[s._v("无法通过游标更新表中的数据。")]),s._v(" "),t("ul",[t("li",[s._v("不可滚动（Nonscrollable）")])]),s._v(" "),t("p",[s._v("只能沿一个方向遍历，不能跳过行。")]),s._v(" "),t("p",[s._v("游标声明必须出现在处理程序声明之前以及变量和条件声明之后。")]),s._v(" "),t("p",[s._v("下面是一个来自官网的例子。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" curdemo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("FALSE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" cur1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURSOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("data")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" cur2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURSOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CONTINUE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("HANDLER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" FOUND "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("TRUE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" cur1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" cur2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  read_loop: "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOOP")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FETCH")]),s._v(" cur1 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FETCH")]),s._v(" cur2 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" done "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEAVE")]),s._v(" read_loop"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" b "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" c "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("THEN")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t3 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ELSE")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("t3 "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LOOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CLOSE")]),s._v(" cur1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CLOSE")]),s._v(" cur2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"_3-定义游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-定义游标"}},[s._v("#")]),s._v(" 3.定义游标")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" cursor_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURSOR")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v(" select_statement\n")])])]),t("p",[s._v("该语句声明一个游标并将其 SELECT 语句结果集关联起来。要稍后获取行，请使用 FETCH 语句。 SELECT 语句检索的列数必须与 FETCH 语句中指定的输出变量数匹配。")]),s._v(" "),t("p",[s._v("SELECT 语句不能有 INTO 子句。")]),s._v(" "),t("p",[s._v("存储程序可以包含多个游标声明，但给定块中声明的每个游标必须具有唯一的名称。")]),s._v(" "),t("h2",{attrs:{id:"_4-打开游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-打开游标"}},[s._v("#")]),s._v(" 4.打开游标")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" cursor_name\n")])])]),t("p",[s._v("这个语句打开先前声明的游标。")]),s._v(" "),t("h2",{attrs:{id:"_5-提取数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-提取数据"}},[s._v("#")]),s._v(" 5.提取数据")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FETCH")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("NEXT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" cursor_name "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" var_name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" var_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("此语句获取与指定游标（必须打开）关联的 SELECT 语句的下一行，并推进游标指针。 如果行存在，则获取的列存储在命名变量中。 SELECT 语句检索的列数必须与 FETCH 语句中指定的输出变量数匹配。")]),s._v(" "),t("p",[s._v("如果没有更多行可用，则会出现“无数据”条件，且 SQLSTATE 值为“02000”。 要检测此条件，您可以为其设置处理程序（或为 NOT FOUND 条件设置处理程序），请参考文首的示例。")]),s._v(" "),t("h2",{attrs:{id:"_6-关闭游标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-关闭游标"}},[s._v("#")]),s._v(" 6.关闭游标")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("CLOSE cursor_name\n")])])]),t("p",[s._v("此语句关闭先前打开的游标。")]),s._v(" "),t("p",[s._v("如果游标未打开，则会发生错误。")]),s._v(" "),t("p",[s._v("如果未显式关闭，游标将在声明它的 BEGIN ... END 块的末尾处自动关闭。")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"参考文献"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[s._v("#")]),s._v(" 参考文献")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://dev.mysql.com/doc/refman/8.0/en/cursors.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL 8.0 Reference Manual :: 13.6.6 Cursors"),t("OutboundLink")],1)]),s._v(" "),t("Vssue",{attrs:{title:"游标"}})],1)}),[],!1,null,null,null);t.default=r.exports}}]);